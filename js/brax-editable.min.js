(function(a,b){'object'==typeof exports&&'undefined'!=typeof module?b(exports,require('tippy.js/src/js/tippy.js')):'function'==typeof define&&define.amd?define(['exports','tippy.js/src/js/tippy.js'],b):b(a.BraxEditable={},a.tippy_js)})(this,function(a,b){'use strict';var c=function(a,b){if(!(a instanceof b))throw new TypeError('Cannot call a class as a function')},d=function(){function a(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,'value'in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(b){c(this,a),this.element=b,this._text=this.element.innerHTML,this._value=this.element.getAttribute('data-value')?this.element.getAttribute('data-value'):this._text,this.type=this.element.getAttribute('data-type')?this.element.getAttribute('data-type'):'text',this.key=this.element.getAttribute('data-key'),this.name=this.element.getAttribute('data-name'),this.url=this.element.getAttribute('data-url'),this.method=this.element.getAttribute('data-get')?'GET':'POST',this.source=this.element.getAttribute('data-source'),this.template=this.element.getAttribute('data-template'),this.hook(),this._isEditing=!1,this.hasInputs=!1,this._inputsEnabled=!0,this.options=[]}return d(a,[{key:'hook',value:function(){var a=this;this.element.classList.add('brax-editable'),this.inputContainer=document.createElement('div'),this.inputContainer.setAttribute('data-input',1),this.inputContainer.className='brax-editable-input';var c={trigger:'click',interactive:!0,html:this.inputContainer,arrow:!0};c.onShow=function(){a.isEditing=!0},c.onShown=function(){a.focus()},c.onHide=function(){a.isEditing=!1},this.tooltip=b.tippy(this.element,c),this.element.setAttribute('data-editing',0),this.element.setAttribute('data-hooked',1)}},{key:'fetchList',value:function(){var a=this;return this.source?void fetch(this.source).then(function(a){return 200===a.status?a.json():(console.error('list response error',a),a)}).then(function(b){if(b.items){if(!a.isEditing)return;a.options=[];var c,d=!0,e=!1;try{for(var f,g=b.items[Symbol.iterator]();!(d=(f=g.next()).done);d=!0){var h=f.value,i={};i.value=h.value,i.text=h.text,h.pk&&(i.value=h.pk),h.id&&(i.value=h.id),h.extra&&(i.extra=h.extra,i.customProperties=i.extra),i.label=i.text,a.options.push(i)}}catch(a){e=!0,c=a}finally{try{!d&&g.return&&g.return()}finally{if(e)throw c}}if(a.inputField){var j,k=!0,l=!1;try{for(var m,n=a.options[Symbol.iterator]();!(k=(m=n.next()).done);k=!0){var i=m.value,o=document.createElement('option');o.value=i.value,o.innerHTML=i.text,a.value==o.value&&o.setAttribute('selected','selected'),a.inputField.appendChild(o)}}catch(a){l=!0,j=a}finally{try{!k&&n.return&&n.return()}finally{if(l)throw j}}}else a.choices&&(a.choices.setChoices(a.options,'value','label',!1),a.value&&a.choices.setValueByChoice(a.value))}else console.log('list response error',b),alert('Error: '+b.statusText)}).catch(function(a){console.log('list error',a)}):(console.error('No source for list provided'),!1)}},{key:'addInputs',value:function(){var a=this;if('select'==this.type)this.inputField=document.createElement('select'),this.inputContainer.appendChild(this.inputField),this.fetchList();else if('choices'==this.type){if(!Choices)return console.error('Choices not found'),!1;this.inputChoices=document.createElement('select'),this.inputContainer.appendChild(this.inputChoices);var b=this;this.choices=new Choices(this.inputChoices,{callbackOnCreateTemplates:function(a){return b.getTemplates(this,a)}}),this.fetchList(),this.buttonClear=document.createElement('button'),this.buttonClear.innerHTML='\uD83D\uDDD1',this.buttonClear.type='button',this.buttonClear.className='brax-editable-button brax-editable-clear',this.buttonClear.title='Clear',this.buttonClear.addEventListener('click',function(b){return a.selectivity.setValue(null),b.preventDefault(),b.stopPropagation(),!1}),this.inputContainer.appendChild(this.buttonClear)}else if('datetime'==this.type){var c=this.value.split(' ')[0],d=this.value.split(' ')[1];this.inputDate=document.createElement('input'),this.inputDate.value=c,this.inputDate.type='date',this.inputContainer.appendChild(this.inputDate),this.inputTime=document.createElement('input'),this.inputTime.value=d,this.inputTime.type='time',this.inputContainer.appendChild(this.inputTime)}else this.inputField=document.createElement('input'),this.inputField.value=this.value,this.inputField.type=this.type,this.enterSave(this.inputField),this.inputContainer.appendChild(this.inputField);this.buttonCancel=document.createElement('button'),this.buttonCancel.innerHTML='\u274C',this.buttonCancel.type='button',this.buttonCancel.className='brax-editable-button brax-editable-cancel',this.buttonCancel.title='Cancel',this.buttonCancel.addEventListener('click',function(b){return a.cancel(),b.preventDefault(),b.stopPropagation(),!1}),this.inputContainer.appendChild(this.buttonCancel),this.buttonSave=document.createElement('button'),this.buttonSave.innerHTML='\uD83D\uDCBE',this.buttonSave.type='button',this.buttonSave.className='brax-editable-button brax-editable-save',this.buttonSave.title='Save',this.buttonSave.addEventListener('click',function(b){return a.save(),b.preventDefault(),b.stopPropagation(),!1}),this.inputContainer.appendChild(this.buttonSave),this.hasInputs=!0}},{key:'enterSave',value:function(a){var b=this;a.addEventListener('keydown',function(a){if(13==a.keyCode)return b.save(),a.preventDefault(),a.stopPropagation(),!1})}},{key:'focus',value:function(){this.inputField&&this.inputField.focus(),this.inputChoices&&(this.choices.showDropdown(),this.choices.input.focus())}},{key:'cancel',value:function(){this.element._tippy.hide()}},{key:'save',value:function(){var a=this;this.inputsEnabled=!1;var b=new FormData;b.append('key',this.key),b.append('name',this.name),b.append('value',this.currentValue);var c={method:this.method,body:b};fetch(this.url,c).then(function(a){return 200===a.status?a.json():(console.error('response error',a),a)}).then(function(b){console.log('response',b),a.inputsEnabled=!0,'ok'==b.status?(b.newValue&&(a.value=b.newValue),b.newText&&(a.text=b.newText),b.message&&alert(b.message),(b.reload||b.refresh)&&location.reload(),b.redirect&&(location.href=b.redirect),a.element._tippy.hide(),a.isEditing=!1):(console.log('response error',b),alert('Error: '+b.statusText))}).catch(function(b){console.log('error',b),a.inputsEnabled=!0})}},{key:'getTemplates',value:function(a,b){var c=a.config,d=c.classNames;return'test'==this.template?{item:function(a){return b('\n\t\t\t\t\t\t<div class="'+d.item+' '+(a.highlighted?d.highlightedState:d.itemSelectable)+'" data-item data-id="'+a.id+'" data-value="'+a.value+'" '+(a.active?'aria-selected="true"':'')+' '+(a.disabled?'aria-disabled="true"':'')+'>\n\t\t\t\t\t\t\t<span>&bigstar;</span> '+a.label+'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t')},choice:function(a){return b('\n\t\t\t\t\t\t<div class="'+d.item+' '+d.itemChoice+' '+(a.disabled?d.itemDisabled:d.itemSelectable)+'" data-select-text="'+c.itemSelectText+'" data-choice '+(a.disabled?'data-choice-disabled aria-disabled="true"':'data-choice-selectable')+' data-id="'+a.id+'" data-value="'+a.value+'" '+(0<a.groupId?'role="treeitem"':'role="option"')+'>\n\t\t\t\t\t\t\t<span>&bigstar;</span> '+a.label+'\n\t\t\t\t\t\t</div>\n\t\t\t\t\t')}}:{item:function(a){return b('\n\t\t\t\t\t<div class="'+d.item+' '+(a.highlighted?d.highlightedState:d.itemSelectable)+'" data-item data-id="'+a.id+'" data-value="'+a.value+'" '+(a.active?'aria-selected="true"':'')+' '+(a.disabled?'aria-disabled="true"':'')+'>\n\t\t\t\t\t\ttest '+a.label+'\n\t\t\t\t\t</div>\n\t\t\t\t')}}}},{key:'isEditing',get:function(){return this._isEditing},set:function(a){this._isEditing||!1==a?this._isEditing&&!0!=a:!this.hasInputs&&this.addInputs(),this._isEditing=a,this.element.setAttribute('data-editing',this._isEditing?1:0)}},{key:'inputsEnabled',get:function(){return this._inputsEnabled},set:function(a){this.inputField&&(this.inputField.disabled=!a),this.inputDate&&(this.inputDate.disabled=!a),this.inputTime&&(this.inputTime.disabled=!a),this.selectivity&&(this.selectivity.enabled=a),this.buttonCancel.disabled=!a,this.buttonSave.disabled=!a,this._inputsEnabled=a}},{key:'currentValue',get:function(){return this.inputDate&&this.inputTime?this.inputDate.value+' '+this.inputTime.value:this.selectivity?this.selectivity.getValue():this.choices?this.choices.getValue(!0):this.inputField?this.inputField.value:(console.error('Nothing to get value from'),!1)}},{key:'text',get:function(){return this._text},set:function(a){this._text=a,this.element.innerHTML=a}},{key:'value',get:function(){return this._value},set:function(a){this._value=a,this.element.setAttribute('data-value',this._value),this.inputField&&(this.inputField.value=this._value)}}]),a}();a.BraxEditable=e,Object.defineProperty(a,'__esModule',{value:!0})});
